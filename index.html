<!DOCTYPE html>
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
		<script type="text/javascript">
			function linear() {
				let _domain = [0, 1];
				let _range = [0, 1];

				let _slope = 1;
				let _intercept = 0;

				function _updateCoefs() {
					_slope = (_range[1] - _range[0]) / (_domain[1] - _domain[0]);
					_intercept = _range[0] - (_slope * _domain[0]);
				}

				function scale (value) {
					return (_slope * value) + _intercept;
				}

				scale.invert = function(value) {
					return (value - _intercept) / _slope;
				};

				scale.domain = function(arr = null) {
					if (arr === null) { return _domain; }

					_domain = arr;
					_updateCoefs();

					return scale;
				};

				scale.range = function(arr = null) {
					if (arr === null) { return _range; }

					_range = arr;
					_updateCoefs();

					return scale;
				};

				return scale;
			}
		</script>

		<style type="text/css">

			layer {
				overflow: hidden; 
				top: 0px; 
				position: absolute; 
				height: 30px; 
				width: 500px; 
				background-color: none;
			}

			segment {
				position: absolute; 
				width: 60px; 
				height: 30px; 
				/*background-color: green;*/
			}
		</style>
	</head>

	<body>
		<ttrack>
			<!-- <layer style="overflow:hidden; top:0; position:absolute; height:30px; width:500px; background-color:red;">
				<segment style="position:absolute; width:60px; height:30px; background-color:yellow;">
				</segment>
			</layer>

			<layer style="overflow:hidden; top:0; position:absolute; height:30px; width:500px; background-color:none;">
				<segment style="position:absolute; width:60px; height:30px; background-color:green; left:20px;">
				</segment>
			</layer> -->
			<layer id="layer1">
			</layer>
			<layer id="layer2">
			</layer>
		</ttrack>

		<script type="text/javascript">

			function addSegment(layer, color, text) {
				var segment = document.createElement('segment');
				var svg = document.createElementNS("http://www.w3.org/2000/svg", 'svg');
				var rect = document.createElementNS("http://www.w3.org/2000/svg", 'rect');
				var div = document.createElement('div');

				segment.setAttribute('component-type', 'segment-container');
				svg.setAttribute('component-type', 'svg-container');
				rect.setAttribute('component-type', 'svg-rectangle');
				div.setAttribute('component-type', 'custom-content');

				svg.setAttributeNS(null, 'width', '100%');
				svg.setAttributeNS(null, 'height', '100%');
				svg.style.position = "absolute";
				svg.style.zIndex = 1;

				rect.setAttributeNS(null, 'width', '100%');
				rect.setAttributeNS(null, 'height', '100%');
				rect.setAttributeNS(null, 'fill', color);
				// rect.setAttributeNS(null, 'fill', 'rgb(0,0,255)');
				// rect.setAttributeNS(null, 'stroke-width', '10');
				// rect.setAttributeNS(null, 'stroke', 'rgb(0,0,0)');

				div.innerHTML = text;
				div.style.position = "absolute";
				div.style.zIndex = 2;

				segment.style.overflow = "hidden";
				segment.style.left = (Math.round(500) * Math.random()) + "px";
				segment.style.bottom = "0px";
				segment.style.height = "100%";

				svg.appendChild(rect);
				segment.appendChild(div);
				segment.appendChild(svg);
				layer.appendChild(segment);
				
			}


			function set_shape(datum, $el) {
				accessors.start(datum);
				accessors.duration(datum);
				accessors.value(datum);
				accessors.handlerWidth(datum);
				accessors.handlerColor(datum);
				accessors.color(datum);
				accessors.content(datum); 
				/*
				 TODO: como trato das dimensões do conteúdo que é devolvido?
				 Não faz sentido estar a a passar uma obra literária num div que vai
				 para dentro de um segment se não há espaço para a mostrar.
				 */
			}
		</script>
		
	</body>
</html>
